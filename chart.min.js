class EZChartJS{constructor(c,o={}){this.container=document.getElementById(c);if(!this.container)throw new Error(`Container with id '${c}' not found`);this.container.innerHTML='';this.canvas=document.createElement('canvas');this.container.appendChild(this.canvas);this.ctx=this.canvas.getContext('2d');this.options={type:'line',title:'',backgroundColor:'#ffffff',responsive:true,maintainAspectRatio:false,...o};this._resizeCanvas();if(this.options.responsive)window.addEventListener('resize',()=>{this._resizeCanvas();if(this.lastData)this.draw(this.lastData);});this.defaultColors=['#3366cc','#dc3912','#ff9900','#109618','#990099','#0099c6','#dd4477','#66aa00','#b82e2e','#316395'];}_resizeCanvas(){if(this.options.responsive){const s=getComputedStyle(this.container);const w=parseInt(s.width);const h=parseInt(s.height)||Math.floor(w*0.6);this.canvas.width=w;this.canvas.height=h;this.canvas.style.width='100%';this.canvas.style.height='100%';}else{this.canvas.width=this.options.width||600;this.canvas.height=this.options.height||400;}}draw(d){this.lastData=d;this.ctx.fillStyle=this.options.backgroundColor;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);if(this.options.title)this._drawTitle();switch(this.options.type.toLowerCase()){case'line':this._drawLineChart(d);break;case'bar':this._drawBarChart(d);break;case'pie':this._drawPieChart(d);break;default:throw new Error(`Unsupported chart type: ${this.options.type}`);}}_drawTitle(){this.ctx.font=this.options.titleFont||'bold 18px Arial';this.ctx.fillStyle=this.options.titleColor||'#333333';this.ctx.textAlign='center';this.ctx.fillText(this.options.title,this.canvas.width/2,30);}_drawLineChart(d){if(!d.labels||!d.datasets)throw new Error('Invalid data format for line chart');const m=60;const gw=this.canvas.width-m*2;const gh=this.canvas.height-m*2;const lc=d.labels.length;this.ctx.strokeStyle=this.options.axisColor||'#cccccc';this.ctx.lineWidth=this.options.axisWidth||1;this.ctx.beginPath();this.ctx.moveTo(m,m+gh);this.ctx.lineTo(m+gw,m+gh);this.ctx.stroke();this.ctx.beginPath();this.ctx.moveTo(m,m);this.ctx.lineTo(m,m+gh);this.ctx.stroke();this.ctx.font=this.options.labelFont||'12px Arial';this.ctx.fillStyle=this.options.labelColor||'#666666';this.ctx.textAlign='center';d.labels.forEach((l,i)=>{const x=m+(i*(gw/(lc-1)));this.ctx.fillText(l,x,m+gh+20);});const max=Math.max(...d.datasets.flatMap(ds=>ds.data));const min=Math.min(...d.datasets.flatMap(ds=>ds.data));const vr=max-min;d.datasets.forEach((ds,di)=>{const clr=ds.color||this.defaultColors[di%this.defaultColors.length];this.ctx.strokeStyle=clr;this.ctx.lineWidth=this.options.lineWidth||2;this.ctx.beginPath();ds.data.forEach((v,i)=>{const x=m+(i*(gw/(lc-1)));const y=m+gh-((v-min)/vr*gh);if(i===0)this.ctx.moveTo(x,y);else this.ctx.lineTo(x,y);});this.ctx.stroke();ds.data.forEach((v,i)=>{const x=m+(i*(gw/(lc-1)));const y=m+gh-((v-min)/vr*gh);this.ctx.fillStyle=clr;this.ctx.beginPath();this.ctx.arc(x,y,this.options.pointRadius||4,0,Math.PI*2);this.ctx.fill();});});this._drawLegend(d.datasets);}_drawBarChart(d){if(!d.labels||!d.datasets)throw new Error('Invalid data format for bar chart');const m=60;const gw=this.canvas.width-m*2;const gh=this.canvas.height-m*2;const lc=d.labels.length;const bgw=gw/lc;const dc=d.datasets.length;const bw=(bgw*0.8)/dc;this.ctx.strokeStyle=this.options.axisColor||'#cccccc';this.ctx.lineWidth=this.options.axisWidth||1;this.ctx.beginPath();this.ctx.moveTo(m,m+gh);this.ctx.lineTo(m+gw,m+gh);this.ctx.stroke();this.ctx.beginPath();this.ctx.moveTo(m,m);this.ctx.lineTo(m,m+gh);this.ctx.stroke();this.ctx.font=this.options.labelFont||'12px Arial';this.ctx.fillStyle=this.options.labelColor||'#666666';this.ctx.textAlign='center';d.labels.forEach((l,i)=>{const x=m+(i*bgw)+bgw/2;this.ctx.fillText(l,x,m+gh+20);});const max=Math.max(...d.datasets.flatMap(ds=>ds.data));const min=Math.min(0,...d.datasets.flatMap(ds=>ds.data));d.datasets.forEach((ds,di)=>{const clr=ds.color||this.defaultColors[di%this.defaultColors.length];ds.data.forEach((v,i)=>{const x=m+(i*bgw)+(di*bw);const bh=((v-min)/(max-min))*gh;const y=m+gh-bh;this.ctx.fillStyle=clr;this.ctx.fillRect(x,y,bw,bh);if(this.options.showValues){this.ctx.fillStyle=this.options.valueColor||'#333333';this.ctx.font=this.options.valueFont||'10px Arial';this.ctx.textAlign='center';this.ctx.fillText(v.toString(),x+bw/2,y-5);}});});this._drawLegend(d.datasets);}_drawPieChart(d){if(!d.labels||!d.datasets||d.datasets.length!==1)throw new Error('Pie chart requires exactly one dataset with matching labels');const ds=d.datasets[0];if(ds.data.length!==d.labels.length)throw new Error('Labels count must match data count for pie chart');const cx=this.canvas.width/2;const cy=this.canvas.height/2;const r=Math.min(this.canvas.width,this.canvas.height)/2-40;let total=ds.data.reduce((s,v)=>s+v,0);if(total<=0)total=1;let sa=-Math.PI/2;ds.data.forEach((v,i)=>{if(v<=0)return;const a=(v/total)*2*Math.PI;const clr=ds.colors?.[i]||this.defaultColors[i%this.defaultColors.length];this.ctx.fillStyle=clr;this.ctx.beginPath();this.ctx.moveTo(cx,cy);this.ctx.arc(cx,cy,r,sa,sa+a);this.ctx.closePath();this.ctx.fill();const ma=sa+a/2;const lr=r*0.7;const lx=cx+Math.cos(ma)*lr;const ly=cy+Math.sin(ma)*lr;const p=((v/total)*100).toFixed(1);const txt=this.options.compactLabels?`${p}%`:`${d.labels[i]} (${p}%)`;this.ctx.font=this.options.labelFont||'12px Arial';this.ctx.fillStyle='#fff';this.ctx.textAlign='center';this.ctx.strokeStyle='#000';this.ctx.lineWidth=2;this.ctx.strokeText(txt,lx,ly+5);this.ctx.fillText(txt,lx,ly+5);sa+=a;});}_drawLegend(ds){if(this.options.hideLegend||this.options.type==='pie')return;const lx=this.canvas.width-150;let ly=40;const lh=20;this.ctx.font=this.options.legendFont||'12px Arial';this.ctx.textAlign='left';ds.forEach((d,i)=>{const c=d.color||this.defaultColors[i%this.defaultColors.length];this.ctx.fillStyle=c;this.ctx.fillRect(lx,ly,15,15);this.ctx.fillStyle=this.options.legendColor||'#333333';this.ctx.fillText(d.label||`Dataset ${i+1}`,lx+20,ly+12);ly+=lh;});}updateOptions(n){this.options={...this.options,...n};this._resizeCanvas();if(this.lastData)this.draw(this.lastData);}destroy(){this.container.innerHTML='';this.canvas=null;this.ctx=null;}}